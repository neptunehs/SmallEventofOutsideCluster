nep_create_enemy_1 = {
	#system scope
	random_list = {
		4 = { #delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 4
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 3
					order_by = trigger:fleet_power
					nep_copy_fleet = yes
				}
				event_target:nep_copy_fleet_temp_fleet = {
					set_owner = event_target:nep_arena_hologram
					set_location = nep_arena_target_pos_1
					if = {
						limit = {
							num_ships > 1
						}
						every_owned_ship = {
							random_list = {
								10 = { delete_ship = this }
								35 = { }
							}
						}
					}
				}
			}
		}
		3 = {  #not delete
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 4
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 3
					order_by = trigger:fleet_power
					nep_copy_fleet = yes
				}
				event_target:nep_copy_fleet_temp_fleet = {
					set_owner = event_target:nep_arena_hologram
					set_location = nep_arena_target_pos_1
				}
			}
		}
		2 = { #double and delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 4
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 3
					order_by = trigger:fleet_power
					nep_copy_fleet_2 = yes
				}
				event_target:nep_copy_fleet_temp_fleet = {
					set_owner = event_target:nep_arena_hologram
					set_location = nep_arena_target_pos_1
					if = {
						limit = {
							num_ships > 1
						}
						every_owned_ship = {
							random_list = {
								10 = { delete_ship = this }
								35 = { }
							}
						}
					}
				}
			}
		} 
		1 = {#double and not delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 4
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 3
					order_by = trigger:fleet_power
					nep_copy_fleet_2 = yes
				}
				event_target:nep_copy_fleet_temp_fleet = {
					set_owner = event_target:nep_arena_hologram
					set_location = nep_arena_target_pos_1
				}
			}
		}
	}
	event_target:nep_copy_fleet_temp_fleet = { 
		if = {
			limit = { fleet_power < 200 }
			destroy_fleet = this
		}
		else_if = {
			limit = { exists = this }
			save_global_event_target_as = nep_arena_target_1 
		}
	}
}

nep_create_enemy_2 = {
	#system scope
	random_list = {
		4 = { #delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 3
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 2
					order_by = trigger:fleet_power
					nep_copy_fleet = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_2
						if = {
							limit = {
								num_ships > 1
							}
							every_owned_ship = {
								random_list = {
									10 = { delete_ship = this }
									35 = { }
								}
							}
						}
					}
				}
			}
		}
		3 = {  #not delete
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 3
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 2
					order_by = trigger:fleet_power
					nep_copy_fleet = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_2
					}
				}
			}
		}
		2 = { #double and delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 3
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 2
					order_by = trigger:fleet_power
					nep_copy_fleet_2 = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_2
						if = {
							limit = {
								num_ships > 1
							}
							every_owned_ship = {
								random_list = {
									10 = { delete_ship = this }
									35 = { }
								}
							}
						}
					}
				}
			}
		} 
		1 = {#double and not delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 3
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 2
					order_by = trigger:fleet_power
					nep_copy_fleet_2 = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_2
					}
				}
			}
		} 
	}
	event_target:nep_copy_fleet_temp_fleet = { 
		if = {
			limit = { fleet_power < 200 }
			destroy_fleet = this
		}
		else_if = {
			limit = { exists = this }
			save_global_event_target_as = nep_arena_target_2
		}
	}
}

nep_create_enemy_3 = {
	#system scope
	random_list = {
		4 = { #delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 2
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 1
					order_by = trigger:fleet_power
					nep_copy_fleet = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_3
						if = {
							limit = {
								num_ships > 1
							}
							every_owned_ship = {
								random_list = {
									10 = { delete_ship = this }
									35 = { }
								}
							}
						}
					}
				}
			}
		}
		3 = {  #not delete
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 2
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 1
					order_by = trigger:fleet_power
					nep_copy_fleet = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_3
					}
				}
			}
		}
		2 = { #double and delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 2
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 1
					order_by = trigger:fleet_power
					nep_copy_fleet_2 = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_3
						if = {
							limit = {
								num_ships > 1
							}
							every_owned_ship = {
								random_list = {
									10 = { delete_ship = this }
									35 = { }
								}
							}
						}
					}
				}
			}
		} 
		1 = {#double and not delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
					num_fleets > 2
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 1
					order_by = trigger:fleet_power
					nep_copy_fleet_2 = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_3
					}
				}
			}
		} 
	}
	event_target:nep_copy_fleet_temp_fleet = { 
		if = {
			limit = { fleet_power < 200 }
			destroy_fleet = this
		}
		else_if = {
			limit = { exists = this }
			save_global_event_target_as = nep_arena_target_3
		}
	}
}

nep_create_enemy_4 = {
	#system scope
	random_list = {
		4 = { #delete some ship
			random_country = {
				limit = { 
					fleet_power > 1 
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 0
					order_by = trigger:fleet_power
					nep_copy_fleet = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_4
						if = {
							limit = {
								num_ships > 1
							}
							every_owned_ship = {
								random_list = {
									10 = { delete_ship = this }
									35 = { }
								}
							}
						}
					}
				}
			}
		}
		3 = {  #not delete
			random_country = {
				limit = { 
					fleet_power > 1 
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 0
					order_by = trigger:fleet_power
					nep_copy_fleet = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_4
					}
				}
			}
		}
		2 = { #double and delete some ship
			random_country = {
				limit = { 
					fleet_power > 1
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 0
					order_by = trigger:fleet_power
					nep_copy_fleet_2 = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_4
						if = {
							limit = {
								num_ships > 1
							}
							every_owned_ship = {
								random_list = {
									10 = { delete_ship = this }
									35 = { }
								}
							}
						}
					}
				}
			}
		} 
		1 = {#double and not delete some ship
			random_country = {
				limit = { 
					fleet_power > 1
				}
				ordered_controlled_fleet = {
					limit = {
						is_ship_class = shipclass_military
					}
					position = 0
					order_by = trigger:fleet_power
					nep_copy_fleet_2 = yes
					event_target:nep_copy_fleet_temp_fleet = {
						set_owner = event_target:nep_arena_hologram
						set_location = nep_arena_target_pos_4
					}
				}
			}
		}
	}
	event_target:nep_copy_fleet_temp_fleet = { 
			if = {
				limit = { fleet_power < 200 }
				destroy_fleet = this
			}
			else_if = {
				limit = { exists = this }
				save_global_event_target_as = nep_arena_target_4
			}
		}
}

nep_copy_fleet = {
	#fleet scope
	create_fleet = {
		effect = {
			set_owner = prev.owner
			prev = {
				every_owned_ship = {
					save_event_target_as = nep_copy_fleet_temp
					prevprev = {
						create_ship = {
							name = random
							design = event_target:nep_copy_fleet_temp
						}
					}
				}
			}
			save_event_target_as = nep_copy_fleet_temp_fleet
		}
	}
}
nep_copy_fleet_2 = {
	#fleet scope
	create_fleet = {
		effect = {
			set_owner = prev.owner
			prev = {
				every_owned_ship = {
					save_event_target_as = nep_copy_fleet_temp
					prevprev = {
						create_ship = {
							name = random
							design = event_target:nep_copy_fleet_temp
						}
						create_ship = {
							name = random
							design = event_target:nep_copy_fleet_temp
						}
					}
				}
			}			
			save_event_target_as = nep_copy_fleet_temp_fleet
		}
	}
}

nep_fleet_rating_arena = {
	set_variable = { which = this value = trigger:fleet_power }
	if = {
		limit = { fleet_power < 1000 }
		set_fleet_flag = nep_rank_G
	}
	else_if = {
		limit = { fleet_power < 4000 }
		set_fleet_flag = nep_rank_F
		if = {
			limit = { has_nep_arena_modifiers = no }
			add_modifier = {
				modifier = nep_arena_rank_F
				days = -1
			}
		}
	}
	else_if = {
		limit = { fleet_power < 12000 }
		set_fleet_flag = nep_rank_E
		if = {
			limit = { has_nep_arena_modifiers = no }
			add_modifier = {
				modifier = nep_arena_rank_E
				days = -1
			}
		}
	}
	else_if = {
		limit = { fleet_power < 28500 }
		set_fleet_flag = nep_rank_D
		if = {
			limit = { has_nep_arena_modifiers = no }
			add_modifier = {
				modifier = nep_arena_rank_D
				days = -1
			}
		}
	}
	else_if = {
		limit = { fleet_power < 60000 }
		set_fleet_flag = nep_rank_C
		if = {
			limit = { has_nep_arena_modifiers = no }
			add_modifier = {
				modifier = nep_arena_rank_C
				days = -1
			}
		}
	}
	else_if = {
		limit = { fleet_power < 200000 }
		set_fleet_flag = nep_rank_B
		if = {
			limit = { has_nep_arena_modifiers = no }
			add_modifier = {
				modifier = nep_arena_rank_B
				days = -1
			}
		}
	}
	else_if = {
		limit = { fleet_power < 3000000 }
		set_fleet_flag = nep_rank_A
		if = {
			limit = { has_nep_arena_modifiers = no }
			add_modifier = {
				modifier = nep_arena_rank_A
				days = -1
			}
		}
	}
	else = {
		set_fleet_flag = nep_rank_S
		if = {
			limit = { has_nep_arena_modifiers = no }
			add_modifier = {
				modifier = nep_arena_rank_S
				days = -1
			}
		}
	}
}