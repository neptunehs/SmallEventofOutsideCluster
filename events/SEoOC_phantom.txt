namespace = nep_phantom

####################################
# scenario
####################################
country_event = {
	id = nep_phantom.1
	hide_window = yes
	
	fire_only_once = yes

	trigger = {
		is_ai = no
		has_global_flag = nep_phantom_available
		has_global_flag = nep_Krahen_end
		has_country_flag = nep_Krahen_orb_get
		NOT = { has_global_flag = nep_corrupted_finalweapons_begin }
	}
	
	mean_time_to_happen = {
		days = 540
	}
	
	immediate = {
		set_global_flag = nep_phantom_begin
		set_global_flag = nep_phantom_passive_stage1
		event_target:global_event_country = {
			country_event = { id = nep_phantom.101 days = 1800 }
			country_event = { id = nep_phantom.102 days = 3600 }
			country_event = { id = nep_phantom.103 days = 7200 }
			country_event = { id = nep_phantom.104 days = 14400 }
		}
		create_phantom_country = yes
		random_system = {
			limit = { 
				is_neighbor_of = root
			}
			random_system = {
				limit = {
					distance = {
						source = prev
						min_jumps = 2
						max_jumps = 4
					}
				}
				create_fleet = {
					name = "NAME_phantom_fleet_krahen_unknown"
					settings = {
						spawn_debris = no 
						can_change_leader = no
						uses_naval_capacity = no
					}
					effect = {
						set_owner = last_created_country
						while = {
							count = 10
							create_ship = {
								name = "NAME_Krahen_invader_phantom"
								design = "NAME_Krahen_Battleship_phantom"
							}
						}
						set_location = {
							target = prev
							distance = 150
							angle = random
						}
						set_fleet_stance = aggressive
						set_aggro_range = 500
						set_aggro_range_measure_from = self
					}
				}
				last_created_fleet = {
					set_fleet_flag = nep_phantom_krahen
					set_fleet_flag = nep_phantom_fleet_passive
					closest_system = {
						limit = {
							any_system_planet = {
								is_colony = yes
								if = {
									limit = {
										root = {
											num_owned_planets > 1
										}
									}
									is_capital = no
								}
								owner = { is_same_value = ROOT }
							}
						}
						random_system_planet = {
							limit = {
								is_colony = yes
								if = {
									limit = {
										root = {
											num_owned_planets > 1
										}
									}
									is_capital = no
								}
								owner = { is_same_value = ROOT }
							}
							PREVPREV = {
								auto_move_to_planet = {
									target = PREV
									clear_auto_move_on_arrival = yes
								}
							}
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = nep_phantom.101
	hide_window = yes

	is_triggered_only = yes
	
	immediate = {
		remove_global_flag = nep_phantom_passive_stage1
		set_global_flag = nep_phantom_passive_stage2
	}	
}

country_event = {
	id = nep_phantom.102
	hide_window = yes

	is_triggered_only = yes
	
	immediate = {
		remove_global_flag = nep_phantom_passive_stage2
		set_global_flag = nep_phantom_passive_stage3
	}	
}

country_event = {
	id = nep_phantom.103
	hide_window = yes

	is_triggered_only = yes
	
	immediate = {
		remove_global_flag = nep_phantom_passive_stage3
		set_global_flag = nep_phantom_passive_stage4
	}	
}

country_event = {
	id = nep_phantom.104
	hide_window = yes

	is_triggered_only = yes
	
	immediate = {
		remove_global_flag = nep_phantom_passive_stage4
		set_global_flag = nep_phantom_passive_stage5
	}	
}

country_event = {
	id = nep_phantom.2
	hide_window = yes

	trigger = {
		has_global_flag = nep_phantom_has_found
		NOT = { has_global_flag = nep_phantom_active_end }
		is_country_type = global_event
	}
	
	mean_time_to_happen = {
		days = 30
	}
	
	immediate = {
		if = {
			limit = {
				if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage1
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 10
					}
				}
				else_if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage2
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 15
					}
				}
				else_if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage3
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 20
					}
				}
				else_if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage4
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 25
					}
				}
				else_if = {
					limit = {
						has_global_flag = nep_phantom_passive_stage5
					}
					count_country = {
						limit = { is_country_type = nep_phantom_passive }
						count < 30
					}
				}
			}
			create_phantom_country = yes
			random_list = {
				3 = { create_phantom_fleet_passive_Krahen = yes }
				5 = { create_phantom_fleet_passive_fallen_empire_01 = yes }
				5 = { create_phantom_fleet_passive_fallen_empire_02 = yes }
				10 = { create_phantom_fleet_passive_humanoid = yes }
				10 = { create_phantom_fleet_passive_mammalian = yes }
				10 = { create_phantom_fleet_passive_molluscoid = yes }
				10 = { create_phantom_fleet_passive_reptilian = yes }
				10 = { create_phantom_fleet_passive_arthropoid = yes }
				#10 = { create_phantom_fleet_passive_plantoid = yes } #To prevent DLC needed,rem it
				3 = { create_phantom_fleet_passive_pirate = yes }
			}
			last_created_fleet = {
				set_fleet_flag = nep_phantom_fleet_passive
				closest_system = {
					limit = {
						any_system_planet = {
							is_colony = yes
							exists = owner
							owner = { is_primitive = no }
							if = {
								limit = {
									owner = { num_owned_planets > 1	}
								}
								is_capital = no
							}
						}
					}
					random_system_planet = {
						limit = {
							is_colony = yes
							exists = owner
							owner = { is_primitive = no }
							if = {
								limit = {
									owner = { num_owned_planets > 1	}
								}
								is_capital = no
							}
						}
						PREVPREV = {
							auto_move_to_planet = {
								target = PREV
								clear_auto_move_on_arrival = yes
							}
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = nep_phantom.3
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		country_event = { id = nep_phantom.3003 } #notification
		add_research_option = tech_nep_phantom_phase_shift
	}
}

#on_fleet_destroyed_perp
country_event = {
	id = nep_phantom.4
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
		from = { owner = { is_country_type = nep_phantom_passive } }
	}
	
	immediate = {
		if = {
			limit = {
				NOR = {
					has_country_flag = nep_phantom_passive_defeated_1
					has_country_flag = nep_phantom_passive_defeated_2
					has_country_flag = nep_phantom_passive_defeated_3
				}
			}
			set_country_flag = nep_phantom_passive_defeated_1
		}
		else_if = {
			limit = {
				has_country_flag = nep_phantom_passive_defeated_1
			}
			remove_country_flag = nep_phantom_passive_defeated_1
			set_country_flag = nep_phantom_passive_defeated_2
		}
		else_if = {
			limit = {
				has_country_flag = nep_phantom_passive_defeated_2
			}
			remove_country_flag = nep_phantom_passive_defeated_2
			set_country_flag = nep_phantom_passive_defeated_3
		}
		if = {
			limit = {
				has_country_flag = nep_phantom_passive_defeated_3
				is_ai = no
			}
			country_event = { id = nep_phantom.3004 } #notifaction
		}
	}
}

country_event = {
	id = nep_phantom.5
	hide_window = yes
	
	is_triggered_only = yes
	
	fire_only_once = yes
	
	trigger = {
		is_ai = no
	}
	
	immediate = {
		#Cluster spawn
		set_spawn_system_batch = begin
		no_scope = {
			spawn_system = {
				min_distance >= 469
				max_distance <= 469
				min_orientation_angle = -90
				max_orientation_angle = -90
				hyperlane = no
				initializer = nep_Gacrus_init
			}
			spawn_system = {
				min_distance >= 492
				max_distance <= 492
				min_orientation_angle = -90
				max_orientation_angle = -90
				hyperlane = no
				initializer = nep_Acrus_init
			}
			spawn_system = {
				min_distance >= 476
				max_distance <= 476
				min_orientation_angle = -89
				max_orientation_angle = -89
				hyperlane = no
				initializer = nep_Imai_init
			}
			spawn_system = {
				min_distance >= 476
				max_distance <= 476
				min_orientation_angle = -91
				max_orientation_angle = -91
				hyperlane = no
				initializer = nep_Mimosa_init
			}
			spawn_system = {
				min_distance >= 479
				max_distance <= 479
				min_orientation_angle = -90
				max_orientation_angle = -90
				hyperlane = no
				initializer = nep_Ginan_init
			}
		}
		every_system = {
			limit = {
				has_star_flag = nep_Scrus_cluster
				NOT = { is_same_value = event_target:nep_Ginan_system }
			}
			add_hyperlane = { from = this to = event_target:nep_Ginan_system }
		}
		set_spawn_system_batch = end
		country_event = { id = nep_phantom.3005 } #notifaction
	}
}

fleet_event = {
	id = nep_phantom.6
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = nep_phantom_active_begin
		event_target:nep_Ginan_system = {
			random_system_ambient_object = {
				save_global_event_target_as = nep_Ginan_debris
				root = {
					set_location = {
						target = prev
						distance = 0
						angle = random
					}
				}
			}
		}
	}
	
	after = {
		#notifaction
		owner = {
			country_event = { id = nep_phantom.3006 } 
			country_event = { id = nep_phantom.30061 days = 30 }
		}
	}
}

fleet_event = {
	id = nep_phantom.61
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_location = {
			target = event_target:nep_seal_3
			distance = 0
			angle = random
		}
	}
	
	after = {
		#notifaction
		owner = {
			country_event = { id = nep_phantom.30062 days = 30 }
		}
	}
}

fleet_event = {
	id = nep_phantom.62
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_location = {
			target = event_target:nep_Ginan_debris
			distance = 0
			angle = random
		}
	}
	
	after = {
		#notifaction
		owner = {
			country_event = { id = nep_phantom.30061 days = 30 }
		}
	}
}

#on_fleet_destroyed_victim
country_event = {
	id = nep_phantom.63
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_active_begin
		has_country_flag = nep_Krahen_orb_get
		From = { is_country_type = nep_phantom_active }
	}
	
	immediate = {
		every_ship = {
			limit = { owner = { is_same_value = root.from } }
			delete_ship = this
		}
		random_system = {
			limit = { has_star_flag = nep_in_phantom_war }
			remove_star_flag = nep_in_phantom_war
		}
	}
	
	after = {
		#notifaction
		owner = {
			country_event = { id = nep_phantom.30061 days = 30 }
		}
	}
}

fleet_event = {
	id = nep_phantom.7
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_active_begin
		owner = { has_country_flag = nep_Krahen_orb_get }
		from = {
			has_star_flag = nep_Scrus_cluster
			NOR = { 
				has_star_flag = nep_Ginan_system 
				has_star_flag = nep_phantom_war_end
			}
		}
	}
	
	immediate = {
		if = {
			limit = { NOT = { any_country = { is_country_type = nep_phantom_active } } }
			create_country = {
				name = "NAME_nep_phantom_country"
				type = nep_phantom_active
				species = random
				auto_delete = no
				flag = {
					icon = {
						category = "zoological"
						file = "flag_zoological_17.dds"
					}
					background = {
						category = "backgrounds"
						file = "stripes.dds"
					}
					colors = {
						"black"
						"dark_grey"
						"null"
						"null"
					}
				}
				effect = {
					establish_communications_no_message = root.owner
				}
			}
		}
		if = {
			limit = {
				NOT = { has_fleet_flag = nep_in_phantom_war }
			}
			set_fleet_flag = nep_in_phantom_war
			add_modifier = {
				modifier = nep_phantom_no_retreat
				days = -1
			}
		}
		solar_system = {
			if = {
				limit = {
					NOR = { 
						has_star_flag = nep_in_phantom_war
						has_star_flag = nep_phantom_war_end		
					}
				}
				set_star_flag = nep_in_phantom_war
				remove_hyperlane = { from = this to = event_target:nep_Ginan_system }
			}
		}
		if = { 
			limit = {
				owner = {
					NOR = { 
						has_country_flag = nep_phantom_active_stage_1
						has_country_flag = nep_phantom_active_stage_2
						has_country_flag = nep_phantom_active_stage_3
					}
				}
			}
			fleet_event = { id = nep_phantom.71 }
			fleet_event = { id = nep_phantom.75 days = 100 }
			owner = {
				country_event = { id = nep_phantom.30071 }
			}
		}
		if = { 
			limit = {
				owner = {
					has_country_flag = nep_phantom_active_stage_1
				}
			}
			fleet_event = { id = nep_phantom.72 }
			fleet_event = { id = nep_phantom.75 days = 110 }
			owner = {
				country_event = { id = nep_phantom.30072 }
			}
		}
		if = { 
			limit = {
				owner = {
					has_country_flag = nep_phantom_active_stage_2
				}
			}
			fleet_event = { id = nep_phantom.73 }
			fleet_event = { id = nep_phantom.75 days = 120 }
			owner = {
				country_event = { id = nep_phantom.30073 }
			}
		}
		if = { 
			limit = {
				owner = {
					has_country_flag = nep_phantom_active_stage_3
				}
			}
			fleet_event = { id = nep_phantom.74 }
			fleet_event = { id = nep_phantom.75 days = 125 }
			owner = {
				country_event = { id = nep_phantom.30074 }
			}
		}
	}
}

fleet_event = {
	id = nep_phantom.71
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		solar_system = { NOT = { has_star_flag = nep_phantom_war_end } }
	}
	
	immediate = {
		solar_system = {
			if = {
				limit = {
					count_system_ships = {
						limit = { owner = { is_same_value = event_target:nep_phantom_active } } 
						count < 100
					}
				}
				root = { create_phantom_fleet_active_random = yes }
			}
		}
		fleet_event = { id = nep_phantom.71 days = 17 }
	}
}

fleet_event = {
	id = nep_phantom.72
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		solar_system = { NOT = { has_star_flag = nep_phantom_war_end } }
	}
	
	immediate = {
		solar_system = {
			if = {
				limit = {
					count_system_ships = {
						limit = { owner = { is_same_value = event_target:nep_phantom_active } } 
						count < 130
					}
				}
				root = { create_phantom_fleet_active_random = yes }
			}
		}
		fleet_event = { id = nep_phantom.72 days = 15 }
	}
}

fleet_event = {
	id = nep_phantom.73
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		solar_system = { NOT = { has_star_flag = nep_phantom_war_end } }
	}
	
	immediate = {
		solar_system = {
			if = {
				limit = {
					count_system_ships = {
						limit = { owner = { is_same_value = event_target:nep_phantom_active } } 
						count < 160
					}
				}
				root = { create_phantom_fleet_active_random = yes
					create_phantom_fleet_active_random = yes }
			}
		}
		fleet_event = { id = nep_phantom.73 days = 15 }
	}
}


fleet_event = {
	id = nep_phantom.74
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		solar_system = { NOT = { has_star_flag = nep_phantom_war_end } }
	}
	
	immediate = {
		solar_system = {
			if = {
				limit = {
					count_system_ships = {
						limit = { owner = { is_same_value = event_target:nep_phantom_active } } 
						count < 200
					}
				}
				root = { create_phantom_fleet_active_random = yes
					create_phantom_fleet_active_random = yes }
			}
		}
		fleet_event = { id = nep_phantom.74 days = 14 }
	}
}


fleet_event = {
	id = nep_phantom.75
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		leader = {
			if = { 
				limit = { NOT = { has_trait = leader_trait_hero_of_mac } } 
				add_trait = leader_trait_hero_of_mac
			}
		}
		remove_fleet_flag = nep_in_phantom_war
		remove_modifier = nep_phantom_no_retreat
		solar_system = {
			remove_star_flag = nep_in_phantom_war
			set_star_flag = nep_phantom_war_end	
			every_fleet_in_system = {
				limit = { 
					owner = { is_country_type = nep_phantom_active }
				}
				destroy_fleet = this
			}
			add_hyperlane = { from = this to = event_target:nep_Ginan_system }
		}
		owner = {
			country_event = { id = nep_phantom.30075 }
		}
		if = {
			limit = { count_system = { count > 3 limit = { has_star_flag = nep_phantom_war_end } } }
			event_target:nep_phantom_global = {
				country_event = { id = nep_phantom.8 }
			}
		}
	}
}

#on_yearly_pulse
event = {
	id = nep_phantom.76
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_active_begin
		NOT = { has_global_flag = nep_phantom_active_end }
	}
	
	immediate = {
		every_system = {
			limit = { has_star_flag = nep_Scrus_cluster }
			every_fleet_in_system = {
				limit = {
					owner = { is_country_type = nep_phantom_active }
					is_in_combat = no
					solar_system = {
						count_system_ships = {
							limit = { owner = { NOT = { is_country_type = nep_phantom_active } } }
							count < 1
						}
					}
				}
				delete_fleet = this
			}
		}
		random_system = {
			limit = {
				NOT = { has_star_flag = nep_in_phantom_war }
				any_ship_in_system = { fleet = { has_fleet_flag = nep_in_phantom_war } }
			}
			random_fleet_in_system = {
				limit = { has_fleet_flag = nep_in_phantom_war }
				remove_fleet_flag = nep_in_phantom_war
				remove_modifier = nep_phantom_no_retreat
			}
		}
		every_system = {
			limit = {
				has_star_flag = nep_Scrus_cluster
				NOT = { has_hyperlane_to = event_target:nep_Ginan_system }
			}			
			add_hyperlane = { from = this to = event_target:nep_Ginan_system }
		}
	}
}

country_event = {
	id = nep_phantom.8
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		country_event = { id = nep_phantom.3008 } #Noti
		country_event = { id = nep_phantom.81 days = 30 random = 15 } #Noti
	}
}

country_event = {
	id = nep_phantom.81
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = nep_phantom_active_end
		set_country_flag = nep_phantom_orb_get
		every_country = {
			limit = { 
				OR = {
					is_country_type = nep_phantom_active
					is_country_type = nep_phantom_passive
				}
			}
			every_owned_fleet = {
				destroy_fleet = this
			}
			destroy_country = yes
		}
		remove_global_flag = nep_phantom_passive_stage1
		remove_global_flag = nep_phantom_passive_stage2
		remove_global_flag = nep_phantom_passive_stage3
		remove_global_flag = nep_phantom_passive_stage4
		remove_global_flag = nep_phantom_passive_stage5
		remove_global_flag = nep_phantom_has_found
		remove_global_flag = nep_code_phantom
		remove_global_flag = nep_code_ghost
		remove_global_flag = nep_code_illusion
		remove_global_flag = nep_code_blurs
		every_country = {
			limit = {
				OR = {
					has_country_flag = nep_phantom_passive_defeated_1
					has_country_flag = nep_phantom_passive_defeated_2
					has_country_flag = nep_phantom_passive_defeated_3
					has_country_flag = nep_phantom_repeller_function_1
					has_country_flag = nep_phantom_repeller_function_2
					has_country_flag = nep_phantom_repeller_function_3
					has_country_flag = nep_phantom_3006_not_first
					has_country_flag = nep_phantom_has_death
					has_country_flag = nep_can_build_repeller
				}
			}
			remove_country_flag = nep_phantom_passive_defeated_1
			remove_country_flag = nep_phantom_passive_defeated_2
			remove_country_flag = nep_phantom_passive_defeated_3
			remove_country_flag = nep_phantom_repeller_function_1
			remove_country_flag = nep_phantom_repeller_function_2
			remove_country_flag = nep_phantom_repeller_function_3
			remove_country_flag = nep_phantom_3006_not_first
			remove_country_flag = nep_phantom_has_death
			remove_country_flag = nep_can_build_repeller
			every_owned_fleet = {
				limit = {
					has_fleet_flag = nep_in_phantom_war
				}
				remove_fleet_flag = nep_in_phantom_war
			}
		}
		every_system = {
			limit = {
				has_star_flag = nep_in_phantom_war
			}
			remove_star_flag = nep_in_phantom_war
		}
		country_event = { id = nep_phantom.30081 } #Noti
	}
}

####################################
# fleet_actions
####################################
#on_fleet_auto_move_arrival
country_event = {
	id = nep_phantom.1001
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
		is_country_type = nep_phantom_passive
	}
	
	immediate = {
		if = {
			limit = { 
				exists = fromfrom
			}
			from = {
				queue_actions = {
					orbit_planet = root.fromfrom
				}
			}
			fromfrom = {
				planet_event = { id = nep_phantom.2001 } #begin energy syphen
			}
		}
		else = {
			from = { fleet_event = { id = nep_phantom.1002 } } #comes to other planet
		}
	}
}

fleet_event = {
	id = nep_phantom.1002
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
	}
	
	immediate = {
		random_system = {
			limit = {
				distance = {
					source = root
					min_distance > 50
					max_distance < 101
				}
			}
			root = {
				set_location = {
					target = PREV
					distance = 50
					angle = random
				}
			}
		}
		random_list = {
			90 = {
				closest_system = {
					limit = {
						any_system_planet = {
							is_colony = yes
							exists = owner
							owner = { is_primitive = no }
							if = {
								limit = {
									owner = { num_owned_planets > 1 }
								}
								is_capital = no
							}
						}
					}
					random_system_planet = {
						limit = {
							is_colony = yes
							exists = owner
							owner = { is_primitive = no }
							if = {
								limit = {
									owner = { num_owned_planets > 1	}
								}								
								is_capital = no
							}
						}
						PREVPREV = {
							auto_move_to_planet = {
								target = PREV
								clear_auto_move_on_arrival = yes
							}
						}
					}
				}
			}
			10 = {
				closest_system = {
					limit = {
						any_system_planet = {
							is_colony = yes
							exists = owner
							owner = { is_primitive = no }
							if = {
								limit = {
									owner = { num_owned_planets > 1	}
								}
								is_capital = no
							}
							owner = { has_country_flag = nep_Krahen_orb_get }
						}
					}
					random_system_planet = {
						limit = {
							is_colony = yes
							exists = owner
							owner = { is_primitive = no }
							if = {
								limit = {
									owner = { num_owned_planets > 1	}
								}
								is_capital = no
							}
							owner = { has_country_flag = nep_Krahen_orb_get }
						}
						PREVPREV = {
							auto_move_to_planet = {
								target = PREV
								clear_auto_move_on_arrival = yes
							}
						}
					}
				}
			}
		}
	}
}

###################################
# planet_actions
###################################
#stage1
planet_event = {
	id = nep_phantom.2001
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_planet_flag = nep_phantom_orbit
		owner = { country_event = { id = nep_phantom.3201 } } #notification
		add_modifier = {
			modifier = nep_phantom_orbit_stage1
			days = 180
		}
		planet_event = { id = nep_phantom.2002 days = 180 } #stage2
	}
}

#stage2
planet_event = {
	id = nep_phantom.2002
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { has_planet_flag = nep_phantom_orbit }
	
	immediate = {
		owner = { country_event = { id = nep_phantom.3202 } } #notification
		add_modifier = {
			modifier = nep_phantom_orbit_stage2
			days = 180
		}
		planet_event = { id = nep_phantom.2100 days = 90 } #death
		planet_event = { id = nep_phantom.2100 days = 180 }	#death
		planet_event = { id = nep_phantom.2003 days = 180 } #stage3
	}
}

#stage3
planet_event = {
	id = nep_phantom.2003
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { has_planet_flag = nep_phantom_orbit }
	
	immediate = {
		owner = { country_event = { id = nep_phantom.3203 } } #notification
		add_modifier = {
			modifier = nep_phantom_orbit_stage3
			days = 360
		}
		planet_event = { id = nep_phantom.2100 days = 45 }  #death
		planet_event = { id = nep_phantom.2100 days = 90 }	#death
		planet_event = { id = nep_phantom.2100 days = 135 }	#death
		planet_event = { id = nep_phantom.2100 days = 180 }	#death
		planet_event = { id = nep_phantom.2100 days = 215 }	#death
		planet_event = { id = nep_phantom.2100 days = 240 }	#death
		planet_event = { id = nep_phantom.2100 days = 275 }	#death
		planet_event = { id = nep_phantom.2100 days = 310 }	#death
		planet_event = { id = nep_phantom.2100 days = 335 }	#death
		planet_event = { id = nep_phantom.2100 days = 360 }	#death
		planet_event = { id = nep_phantom.2004 days = 360 } #stage4
	}
}

#stage4
planet_event = {
	id = nep_phantom.2004
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = { has_planet_flag = nep_phantom_orbit }
	
	immediate = {
		owner = { country_event = { id = nep_phantom.3204 } } #notification
		add_modifier = {
			modifier = nep_phantom_orbit_stage4
			days = 360
		}
		planet_event = { id = nep_phantom.2101 days = 23 }  #death loop
	}
}

#death
planet_event = {
	id = nep_phantom.2100
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_owned_pop = {
			kill_pop = yes
		}
		owner = { country_event = { id = nep_phantom.3210 } } #notification
	}
}

#death loop
planet_event = {
	id = nep_phantom.2101
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_owned_pop = {
			kill_pop = yes
		}
		owner = { country_event = { id = nep_phantom.3210 } } #notification
		planet_event = { id = nep_phantom.2101 days = 22 }  #death loop
	}
}

#build repeller
planet_event = {
	id = nep_phantom.2200
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		owner = { country_event = { id = nep_phantom.3220 } } #notification
		set_planet_flag = nep_phantom_repeller_build
	}
}

planet_event = {
	id = nep_phantom.2201
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_planet_flag = nep_phantom_planet_no_more_noti
			}
			remove_planet_flag = nep_phantom_planet_no_more_noti
		}
		solar_system = {
			random_fleet_in_system = {
				limit = {
					owner = { has_country_flag = nep_phantom_passive }
				}
				clear_fleet_actions = this
				fleet_event = { id = nep_phantom.1002 }
			}
		}
		owner = {
			if = {
				limit = {
					NOR = {
						has_country_flag = nep_phantom_repeller_function_1
						has_country_flag = nep_phantom_repeller_function_2
						has_country_flag = nep_phantom_repeller_function_3
					}
				}
				set_country_flag = nep_phantom_repeller_function_1
			}
			else_if = {
				limit = {
					has_country_flag = nep_phantom_repeller_function_1
				}
				remove_country_flag = nep_phantom_repeller_function_1
				set_country_flag = nep_phantom_repeller_function_2
			}
			else_if = {
				limit = {
					has_country_flag = nep_phantom_repeller_function_2
				}
				remove_country_flag = nep_phantom_repeller_function_2
				set_country_flag = nep_phantom_repeller_function_3
			}
			owner = { country_event = { id = nep_phantom.3221 } } #notification
		}
	}
}
###################################
# notification
###################################
#first encount,on_enforce_borders
country_event = {
	id = nep_phantom.3001
	title = "nep_phantom.3001.name"
	desc = "nep_phantom.3001.desc"
	picture = GFX_evt_news_room
	location = FromFromFrom
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		has_global_flag = nep_phantom_begin
		has_country_flag = nep_Krahen_orb_get
		from = { is_country_type = nep_phantom_passive }
		FromFrom = { has_fleet_flag = nep_phantom_krahen }
	}
	
	immediate = {
		set_global_flag = nep_phantom_has_found
	}
	
	option = {
		name = nep_phantom.3001.a
	}
}

country_event = {
	id = nep_phantom.3003
	title = "nep_phantom.3003.name"
	desc = "nep_phantom.3003.desc"
	picture = GFX_evt_engineering_research
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3003.a
	}
}

country_event = {
	id = nep_phantom.3004
	title = "nep_phantom.3003.name"
	desc = "nep_phantom.3003.desc"
	picture = GFX_evt_engineering_research
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3004.a
		enable_special_project = {
			name = nep_phantom_research_2
			owner = this
			location = capital_scope
		}
	}
}

			
country_event = {
	id = nep_phantom.3005
	title = "nep_phantom.3005.name"
	desc = "nep_phantom.3005.desc"
	picture = GFX_evt_engineering_research
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3005.a
		hidden_effect = {
			random_planet = {
				limit = {
					has_planet_flag = nep_seal_3
				}
				save_event_target_as = nep_seal_3
			}
		}
		enable_special_project = {
			name = nep_phantom_Ginan
			owner = this
			location = event_target:nep_seal_3
		}
	}
}


country_event = {
	id = nep_phantom.3006
	title = "nep_phantom.3006.name"
	desc = {
		trigger = {
			NOT = { has_country_flag = nep_phantom_3006_not_first }
		}
		text = "nep_phantom.3006.desc.a"
	}
	desc = {
		trigger = {
			has_country_flag = nep_phantom_3006_not_first
		}
		text = "nep_phantom.3006.desc.b"
	}
	picture = GFX_evt_black_hole
	location = from
	
	is_triggered_only = yes
	
	immediate = {
	}
	
	after = {
		set_country_flag = nep_phantom_3006_not_first
	}
	
	option = {
		name = nep_phantom.3006.a
		trigger = { NOT = { has_country_flag = nep_phantom_3006_not_first } }
	}
	
	option = {
		name = nep_phantom.3006.b
		trigger = { has_country_flag = nep_phantom_3006_not_first }
	}
}

country_event = {
	id = nep_phantom.30061
	title = "nep_phantom.30061.name"
	desc = "nep_phantom.30061.desc"
	picture = GFX_evt_black_hole
	location = event_target:nep_Ginan_system
	
	is_triggered_only = yes
	
	immediate = {
	}
		
	option = {
		name = nep_phantom.30061.a
		enable_special_project = {
			name = nep_phantom_Ginan_2
			owner = this
			location = event_target:nep_Ginan_debris
		}
	}
}

country_event = {
	id = nep_phantom.30062
	title = "nep_phantom.30062.name"
	desc = "nep_phantom.30062.desc"
	picture = GFX_evt_black_hole
	location = event_target:nep_seal_3
	
	is_triggered_only = yes
	
	immediate = {
	}
		
	option = {
		name = nep_phantom.30062.a
		enable_special_project = {
			name = nep_phantom_Ginan_3
			owner = this
			location = event_target:nep_seal_3
		}
	}
}

country_event = {
	id = nep_phantom.30071
	title = "nep_phantom.30071.name"
	desc = "nep_phantom.30071.desc"
	picture = GFX_evt_ruined_system
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30071.a
	}
}

country_event = {
	id = nep_phantom.30072
	title = "nep_phantom.30072.name"
	desc = "nep_phantom.30072.desc"
	picture = GFX_evt_ruined_system
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30072.a
	}
}

country_event = {
	id = nep_phantom.30073
	title = "nep_phantom.30073.name"
	desc = "nep_phantom.30073.desc"
	picture = GFX_evt_ruined_system
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30073.a
	}
}

country_event = {
	id = nep_phantom.30074
	title = "nep_phantom.30074.name"
	desc = "nep_phantom.30074.desc"
	picture = GFX_evt_ruined_system
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30074.a
	}
}

country_event = {
	id = nep_phantom.30075
	title = "nep_phantom.30075.name"
	desc = "nep_phantom.30075.desc"
	picture = GFX_evt_pirates_attacking_cargo
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30075.a
	}
}

country_event = {
	id = nep_phantom.3008
	title = "nep_phantom.3008.name"
	desc = "nep_phantom.3008.desc"
	picture = GFX_evt_towel
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3008.a
	}
}

country_event = {
	id = nep_phantom.30081
	title = "nep_phantom.30081.name"
	desc = "nep_phantom.30081.desc"
	picture = GFX_evt_space_walk
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.30081.a
		add_research_option = tech_nep_phantom_aux
	}
}

country_event = {
	id = nep_phantom.3201
	title = "nep_phantom.3201.name"
	desc = {
		trigger = {
			NOT = { has_country_flag = nep_phantom_3201_not_first }
		}
		text = "nep_phantom.3201.desc.a"
	}
	desc = {
		trigger = {
			has_country_flag = nep_phantom_3201_not_first
		}
		text = "nep_phantom.3201.desc.b"
	}
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3201.aa
		trigger = { NOT = { has_country_flag = nep_phantom_3201_not_first } }
		hidden_effect = {
			set_global_flag = nep_code_phantom
			create_country = {
				name = "NAME_nep_phantom"
				type = nep_phantom_global_event
				effect = {
					save_global_event_target_as = nep_phantom_global
				}
			}
		}
	}
	
	option = {
		name = nep_phantom.3201.ab
		trigger = { NOT = { has_country_flag = nep_phantom_3201_not_first } }
		hidden_effect = {
			set_global_flag = nep_code_ghost
			create_country = {
				name = "NAME_nep_ghost"
				type = nep_phantom_global_event
				effect = {
					save_global_event_target_as = nep_phantom_global
				}
			}
		}
	}
	
	option = {
		name = nep_phantom.3201.ac
		trigger = { NOT = { has_country_flag = nep_phantom_3201_not_first } }
		hidden_effect = {
			set_global_flag = nep_code_illusion
			create_country = {
				name = "NAME_nep_illusion"
				type = nep_phantom_global_event
				effect = {
					save_global_event_target_as = nep_phantom_global
				}
			}
		}
	}
	
	option = {
		name = nep_phantom.3201.ad
		trigger = { NOT = { has_country_flag = nep_phantom_3201_not_first } }
		hidden_effect = {
			set_global_flag = nep_code_blurs
			create_country = {
				name = "NAME_nep_blurs"
				type = nep_phantom_global_event
				effect = {
					save_global_event_target_as = nep_phantom_global
				}
			}
		}
	}
	
	option = {
		name = nep_phantom.3201.b
		trigger = { has_country_flag = nep_phantom_3201_not_first }
	}
}

country_event = {
	id = nep_phantom.3202
	title = "nep_phantom.3202.name"
	desc = {
		trigger = {
			NOT = { has_country_flag = nep_phantom_has_death }
		}
		text = "nep_phantom.3202.desc.a"
	}
	desc = {
		trigger = {
			has_country_flag = nep_phantom_3202_has_death
		}
		text = "nep_phantom.3202.desc.b"
	}
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3202.a
	}
}

country_event = {
	id = nep_phantom.3203
	title = "nep_phantom.3203.name"
	desc = "nep_phantom.3203.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3203.a
	}
}

country_event = {
	id = nep_phantom.3204
	title = "nep_phantom.3204.name"
	desc = "nep_phantom.3204.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3204.a
	}
}

country_event = {
	id = nep_phantom.3210
	title = "nep_phantom.3210.name"
	desc = {
		trigger = {
			NOT = { has_country_flag = nep_phantom_has_death }
		}
		text = "nep_phantom.3210.desc.a"
	}
	desc = {
		trigger = {
			has_country_flag = nep_phantom_has_death
		}
		text = "nep_phantom.3210.desc.b"
	}
	picture = GFX_evt_disease_outbreak
	location = from
	
	is_triggered_only = yes
	
	trigger = {
		from = { has_planet_flag = nep_phantom_planet_no_more_noti }
	}
		
	immediate = {
		from = {
			if = {
				limit = {
					has_modifier = nep_phantom_planet_debuff_death
				}
				remove_modifier = nep_phantom_planet_debuff_death
			}
			add_modifier = {
				modifier = nep_phantom_planet_debuff_death
				days = 180
			}			
		}
	}
	
	after = {
		if = {
			limit = {
				NOT = { has_country_flag = nep_phantom_has_death }
			}
			set_country_flag = nep_phantom_has_death
		}
	}
	
	option = {
		name = nep_phantom.3210.a
	}
	option = {
		name = nep_phantom.3210.aa
		trigger = {
			NOR = { 
				has_country_flag = nep_can_build_repeller
				has_special_project = nep_phantom_research_repeller
			}
		}
		enable_special_project = {
			name = nep_phantom_research_repeller
			owner = this
			location = capital_scope
		}
	}
	
	option = {
		name = nep_phantom.3210.b
		trigger = {
			OR = {
				has_country_flag = nep_can_build_repeller
				has_special_project = nep_phantom_research_repeller
			}			
		}
		hidden_effect = { from = { set_planet_flag = nep_phantom_planet_no_more_noti } }
	}
}

country_event = {
	id = nep_phantom.3211
	title = "nep_phantom.3211.name"
	desc = "nep_phantom.3211.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
		set_country_flag = nep_can_build_repeller
	}
	
	option = {
		name = nep_phantom.3211.a
		custom_tooltip = nep_phantom.3211.a.tooltip
	}
}

country_event = {
	id = nep_phantom.3220
	title = "nep_phantom.3220.name"
	desc = "nep_phantom.3220.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
		
	immediate = {
	}
	
	option = {
		name = nep_phantom.3220.a
	}
}

country_event = {
	id = nep_phantom.3221
	title = "nep_phantom.3221.name"
	desc = "nep_phantom.3221.desc"
	picture = GFX_evt_in_the_dark
	location = from
	
	is_triggered_only = yes
			
	immediate = { }
	
	option = {
		name = nep_phantom.3221.a
	}
	
	option = {
		name = nep_phantom.3221.b
		trigger = { has_country_flag = nep_phantom_repeller_function_3 }
		enable_special_project = {
			name = nep_phantom_research
			owner = this
			location = capital_scope
		}
	}
}